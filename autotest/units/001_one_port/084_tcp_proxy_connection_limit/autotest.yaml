steps:
- cli:
  - rib static insert default 10.0.1.0/24 10.0.1.1
  - rib static insert default 10.0.1.0/24 10.0.1.2
  - rib static insert default 10.0.2.0/24 10.0.2.1
  - rib prefixes

- sendPackets:
  - port: kni0
    send: 001-send.pcap
    expect: 001-expect.pcap

- cli:
  - proxy blacklist add 10.0.1.1 tcp 80 10.0.2.1 1
  - proxy blacklist add 10.0.1.1 tcp 80 10.0.2.10 60
  - proxy blacklist 10.0.1.1 tcp 80

- sendPackets:
  - port: kni0
    send: 002-send.pcap
    expect: 002-expect.pcap

- sleep: 4

- sendPackets:
  - port: kni0
    send: 003-send.pcap
    expect: 003-expect.pcap

- sleep: 1

- sendPackets:
  - port: kni0
    send: 004-send.pcap
    expect: 004-expect.pcap

- sendPackets:
  - port: kni0
    send: 005-send.pcap
    expect: 005-expect.pcap

- sleep: 1

- sendPackets:
  - port: kni0
    send: 005_2-send.pcap
    expect: 005_2-expect.pcap

# timeout should be unchanged
- cli:
  - proxy blacklist add 10.0.1.1 tcp 80 10.0.2.10 60
  - proxy blacklist 10.0.1.1 tcp 80

- cli:
  - proxy connections 10.0.1.1 tcp 80
  - proxy syn 10.0.1.1 tcp 80

- sendPackets:
  - port: kni0
    send: 006-send.pcap
    expect: 006-expect.pcap

- cli:
  - proxy blacklist add 10.0.1.2 tcp 80 10.0.2.1 1
  - proxy blacklist 10.0.1.2 tcp 80

- sendPackets:
  - port: kni0
    send: 007-send.pcap
    expect: 007-expect.pcap

- cli:
  - rib static remove default 10.0.1.0/24 10.0.1.1
  - rib static remove default 10.0.1.0/24 10.0.1.2
  - rib static remove default 10.0.2.0/24 10.0.2.1
  - proxy connections 10.0.1.2 tcp 80
  - proxy syn 10.0.1.2 tcp 80
  - proxy counters 10.0.1.2 tcp 80
